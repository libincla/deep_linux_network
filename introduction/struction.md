## 结构

## arrangement
- `linux`源码版本: 3.10
- 驱动程序，采用`intel`的`igb`网卡驱动
- 内存开销使用`B`作为单位

## 名词解释

- `hi`: `CPU`开销中硬中断消耗的部分
- `si`: `CPU`开销中软中断消耗的部分 
- `skb`: `skb`是`struct sk_buff`对象的简称，`struct sk_buff`是`linux`网络模块中的核心结构体，各个层用到的数据包都是存在这个结构体中的
- `NAPI`: `linux 2.5`以后内核引入的高效网卡数据处理的技术，首先先用中断唤醒内核接收数据，后续采用`poll`轮询从网卡设备中获取数据，通过减少中断次数来提高内核处理网卡数据的效率
- `MSI/MSIx`: `MSI`是`Message Signal interrupt`首字母缩写，触发`CPU`中断的方式



### 内核如何接收网络包
将看到**网卡**， `RingBuffer`, **硬中断**，**软中断**等组件是如何紧密配合
将了解发送过程是如何消耗`CPU`，为什么网卡开启多队列能提升网络性能

## 内核是如何与用户进程协作？
- 将分析阻塞到底干了什么
- 为什么同步阻塞的网络`IO`模型性能差
- 为什么`epoll`有高效的深层次原理
- 以及为什么`Redis`可以达到10万的`QPS`

## 内核是如何发送网络包

- 为什么软中断中`NET_RX`要远远高于`NET_TX`
- 如何理解内核在发送网络包时涉及了哪些内存拷贝操作
- 如何理解`kafka`中使用到的零拷贝
- 如何了解在查看发送网络包时的`CPU`消耗

## 理解本机网络IO

- 本机网络`IO`经过网卡么
- 和外部网络通信相比，内核收发流程有什么差别？

## 理解`TCP`连接建立过程

**三次握手**做了哪些操作
- 半/全队列的创建和长度限制
- 客户端端口的选择
- 半连接队列的添加/删除
- 全连接队列的添加/删除
- 重传定时器的启动

## 单条`TCP`连接消耗多大内存
内核同应用程序一样，需要不停申请、释放内存。但同应用程序不同的是，内核使用`SLAB`方式管理内存
- 了解内存分配方式
- `slabtop`工具看到一条`TCP`状态的空连接是如何消耗内存，消耗是多大

## 单台服务器最多支持多少`TCP`连接

- 在服务器端、客户端最大能达到多少条`TCP`连接，如何突破65535个端口号的束缚来创建更多连接
- 一亿个用户的长连接推送需要多少台服务器？

## 网络性能优化建议

- 讨论一些网络开发的优化手段
  - `RingBuffer`的扩容
  - 多队列网卡的使用
  - 配置充足的端口范围
  - 使用零拷贝
  - `DPDK`、`Kernel-ByPass`之类的新技术

## 容器网络虚拟化

目前趋势是部署到基于`Docker`的容器云上，需要理解容器网络工作原理
- `veth`
- `namespace`
- `bridge`
