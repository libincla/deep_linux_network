# confuse in working


## 过多的timewait
曾经: 服务器上过多（3w）的`TIME_WAIT`，使用`tcp_tw_reuse`和`tcp_tw_recycle`先解决了
思考: **一个`TIME_WAIT`状态的连接到底会有哪些开销**
     1. 到底是端口占用导致新连接无法建立 
     2. 还是过多消耗服务器上的内存
     3. 3w的`TIME_WAIT`算`warning`还是`error`


## 长连接开销
1. `redis`实例在开启长连接猴，出现了6000多条`TCP`连接，上线以后观察发现没有太大问题
思考: 吃不准一条空闲的`TCP`连接到底有多大的开销，引申
    1. 一台服务器最多可以支撑多少条`TCP`连接
       1. 是否有量化的估计
       2. 该数值 受`CPU`影响还是受内存大小限制
       3. 一台服务器可能支撑100w的并发长连接么
    2. 一台客户端最多可以支撑多少条`TCP`连接
       1. 客户端请求建立连接都是在`TCP`协议中占用一个16位的整数(0-65535)，是否意味着客户端单机最多只建立65535条连接
    3. 一条`TCP`连接需要消耗多大的内存?
       1. 一条`TCP`连接需要吃掉多少内存，是`KB`还是几十`KB`还是几`MB`


##